#include <stdio.h>
#include <stdlib.h>
#include <omp.h>


long double fatorial(int n){
    if (n == 0){
        return 1;
    }
    long double res = 1;
    for (long double i = 1; i <= n; i++){
            res *= i;
        }
    return res;
}

int main(int  argc, char *argv[])
{
    long double res = 0.0; //inicializando res
    
    int iteracoes = atoi(argv[1]);
    int qtd_thread = atoi(argv[2]);
    
    // ZONA PARALELA ABAIXO
    #pragma omp parallel num_threads(qtd_thread) reduction(+: res) //diretiva de compilação do openmp com a qtd de threads e o reduction para a zona crítica
    {   
      long double teste = 1.0/19792618901050100552850370901568324491091476598455474533349138121447944050325455850220281751827991384731053649988146087506707500713316118450297463542626967177677317383212058137982824491114171272675325925385091291348344674979200530993915365120537997037788115972151350365016904816499136885828794831985778358219533899724906196428924462793239208373259569980666491941948491688531157807561724110851652739304334136004591199891978806967456331982495640534174613526738910323044744523281810359662924140161968085802174927702027366144023962261879724957022413921518821003624008695403198223408428573788493328660304425682841558674829441437291732515789186402991397163203897141160336978345599243498249364039658855817799979632528308994450886197814548433145091251578381565049749658112815806689758223715290365638492491992735096565546943213902798919272649028917874538001328105166441899683241060502445440113694282322244584050992214829266737568265565147130952913069765264311603420219853097231644370301875199624359666003771097786048493988649018561061422651010642224110759242062896270695123637591659253079701793479163641485869085830076204418000154341720940406976446204231289088236363114711048038756369547511693735325367128720014655716948561876751380950539770459473439810843031005135187629468546260804010901771043272527750486288550056587926992141108600609048080682349545223363550668549969826968411197526095024141458631963384517117816944418167272223756048632904414788440168884977726254971513384701083027721696601240868658349934681024453916139055533173828280975072161250230678766722735688960104944143588847089750300743671668207755677938523117936354562839743392336482208193724881335215308906111441934126608844980315086606414923649730205907156086329528401780691096939429689638080901430342438319489153495975524475787861753289610093111203190783015121956660741004785046570825463368919984420132011367331559584322177073939108383195334757979423034892784699077071750683038289442496189252810408511426468756566092232682212947623213890008449024670383417296700912399278859516597609984833070311095186477566780847748598098887623194207377034979483832865197984175319367200164230775881872125558071802200605586624897037870168402192750354683901371167954338441233101412391016861928006819024316869506213223441036849635065082993882684701780877414922453568609752674893665003188540157177037296150724620662351351943541055194257043158843540609675072447908266747442694779693271275625905162991558428024797357498290175934608776530314835464903478151154657598060727934397651422356400431765248369227574410097385831331745592853824751044210600532143140117522973364473780223566022418580907429985705449455910418485579485336879492441449760389365912653485252372037909830963249405108104253548777034454639803958585401256339516258749871856322010914314002057229264400105093246582584711387995066768479986142681783210959414386412029436944927347470697158059534383975977724748342492255032676191199050046388732476133109881363960919967702683896251409790161107378717999862751282058396285448769913927666124075980748550001835646336284448917221752366570009952062496220414971255921052753939596506110459162890502135573562557037370393488209109096950347818817341853656944820163940157902225873582002975324265417546162879457858736334381975081968887994188967026046597517253251462332189081807866165230591278027604755114148117620428055622265730775414471278888693764470123466586820863416749147364220592619471177011768619205983179801033987946504454913716066813837900672082251612136246193809092451347844335685371087205281106210809530745443376307900563116629574221118364138624672673493418611309530426670898241804633051747554969124193251370002935050517852199813133883136379309139754736867710521951665801628709974843743450383141092987245845233899317368135082621408025066342565909218092923135384768331770348658633807837274673729205713521881489901252466190325984708138502065278557285405816157387741358011104554497688686538062714688742659289925996604996431153831148147247545495881571414226695373260931530523491054948179625413028447305648396371243474365222837471772455405612172501831105819480281660524752076445635674064111164484503817344876336982583660470890991230668951889238391507888465710128403771785743526783830866988821138329241011650308210409934309318815677390464031529346122450232272003314073439002939704387887871055310731736070014958552233350025195859006759041932363749060800654468613018772921664585622106859147958728229165310056135572947274803199844813366705599620684932569957969624604178915887383644340598792882772272253056143966745756991550306631905501669509891422091558878374974656837600873729798008290992519443998111738599637728825353076346451831884027369464447642606987110969799714031282561628041282826041833066716213605750718096992275386578993508438600918098693356818893.000000;
      printf("O teste é = %Lf", teste);  
      int id_thread = omp_get_thread_num();
      int qtd_thread = omp_get_num_threads();
    
    
      long int i;
    
      // As threads vão intercalar o cálculo baseado em seu id
      for(i = id_thread; i < iteracoes; i = i+qtd_thread){
          res += 1.0/fatorial(i);   
          /*if (i == 1754){ // Limite do fatorial para long double 
              printf("\nA iteração em que res converge é %ld",i);
          }   */ 
      }
    }
    // SAIU DA ZONA PARALELA
    printf("\nResultado com %d iteracoes: %0.30Lf\n", iteracoes, res);   
}
