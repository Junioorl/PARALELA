#include <stdio.h>
#include <stdlib.h>
#include <omp.h>


long double fatorial(int n){
    if (n == 0){
        return 1;
    }
    long double res = 1;
    for (long double i = 1; i <= n; i++){
            res *= i;
        }
    return res;
}

int main(int  argc, char *argv[])
{
    long double res = 0.0; //inicializando res
    
    int iteracoes = atoi(argv[1]);
    int qtd_thread = atoi(argv[2]);
    
    // ZONA PARALELA ABAIXO
    #pragma omp parallel num_threads(qtd_thread) reduction(+: res) //diretiva de compilação do openmp com a qtd de threads e o reduction para a zona crítica
    {   
      long double teste = 1.0/1979261890105010055285037090156832449109147659845547453334913812144794405032545585022028175182799138473105364998814608750670750071331611845029746354262696717767731738321205813798282449111417127267532592538509129134834467497920053099391536512053799703778811597215135036501690481649913688582879483198577835821953389972490619642892446279323920837325956998066649194194849168853115780756172411085165273930433413600459119989197880696745633198249564053417461352673891032304474452328181035966292414016196808580217492770202736614402396226187972495702241392151882100362400869540319822340842857378849332866030442568284155867482944143729173251578918640299139716320389714116033697834559924349824936403965885581779997963252830899445088619781454843314509125157838156504974965811281580668975822371529036563849249199273509656554694321390279891927264902891787453800132810516644189968324106050244544011369428232224458405099221482926673756826556514713095291306976526431160342021985309723164437030187519962435966600377109778604849398864901856106142265101064222411075924206289627069512363759165925307970179347916364148586908583007620441800015434172094040697644620423128908823636311471104803875636954751169373532536712872001465571694856187675138095053977045947343981084303100513518762946854626080401090177104327252775048628855005658792699214110860060904808068234954522336355066854996982696841119752609502414145863196338451711781694441816727222375604863290441478844016888497772625497151338470108302772169660124086865834993468102445391613905553317382828097507216125023067876672273568896010494414358884708975030074367166820775567793852311793635456283974339233648220819372488133521530890611144193412660884498031508660641492364973020590715608632952840178069109693942968963808090143034243831948915349597552447578786175328961009311120319078301512195666074100478504657082546336891998442013201136733155958432217707393910838319533475797942303489278469907707175068303828944249618925281040851142646875656609223268221294762321389000844902467038341729670091239927885951659760998483307031109518647756678084774859809888762319420737703497948383286519798417531936720016423077588187212555807180220060558662489703787016840219275035468390137116795433844123310141239101686192800681902431686950621322344103684963506508299388268470178087741492245356860975267489366500318854015717703729615072462066235135194354105519425704315884354060967507244790826674744269477969327127562590516299155842802479735749829017593460877653031483546490347815115465759806072793439765142235640043176524836922757441009738583133174559285382475104421060053214314011752297336447378022356602241858090742998570544945591041848557948533687949244144976038936591265348525237203790983096324940510810425354877703445463980395858540125633951625874987185632201091431400205722926440010509324658258471138799506676847998614268178321095941438641202943694492734747069715805953438397597772474834249225503267619119905004638873247613310988136396091996770268389625140979016110737871799986275128205839628544876991392766612407598074855000183564633628444891722175236657000995206249622041497125592105275393959650611045916289050213557356255703737039348820910909695034781881734185365694482016394015790222587358200297532426541754616287945785873633438197508196888799418896702604659751725325146233218908180786616523059127802760475511414811762042805562226573077541447127888869376447012346658682086341674914736422059261947117701176861920598317980103398794650445491371606681383790067208225161213624619380909245134784433568537108720528110621080953074544337630790056311662957422111836413862467267349341861130953042667089824180463305174755496912419325137000293505051785219981313388313637930913975473686771052195166580162870997484374345038314109298724584523389931736813508262140802506634256590921809292313538476833177034865863380783727467372920571352188148990125246619032598470813850206527855728540581615738774135801110455449768868653806271468874265928992599660499643115383114814724754549588157141422669537326093153052349105494817962541302844730564839637124347436522283747177245540561217250183110581948028166052475207644563567406411116448450381734487633698258366047089099123066895188923839150788846571012840377178574352678383086698882113832924101165030821040993430931881567739046403152934612245023227200331407343900293970438788787105531073173607001495855223335002519585900675904193236374906080065446861301877292166458562210685914795872822916531005613557294727480319984481336670559962068493256995796962460417891588738364434059879288277227225305614396674575699155030663190550166950989142209155887837497465683760087372979800829099251944399811173859963772882535307634645183188402736946444764260698711096979971403128256162804128282604183306671621360575071809699227538657899350843860091809869335681889347830473185048751798179890694678112551781358928289582491754088122265189877759716054142230730539765341914208711733424092011.000000;
      printf("O teste é = %Lf", teste);  
      int id_thread = omp_get_thread_num();
      int qtd_thread = omp_get_num_threads();
    
    
      long int i;
    
      // As threads vão intercalar o cálculo baseado em seu id
      for(i = id_thread; i < iteracoes; i = i+qtd_thread){
          res += 1.0/fatorial(i);   
          /*if (i == 1754){ // Limite do fatorial para long double 
              printf("\nA iteração em que res converge é %ld",i);
          }   */ 
      }
    }
    // SAIU DA ZONA PARALELA
    printf("\nResultado com %d iteracoes: %0.30Lf\n", iteracoes, res);   
}
